ファイル名: MELSEC_iQ-R_プログラミングマニュアル（CPUユニット用命令_汎用FUN_汎用FB編）_page581

<overview>
本ページは、サブルーチンプログラムの動作例を示すテキストとラダープログラムの図、サブルーチン実行前後のデバイス値の変化を示す表形式の図、CALL命令のネスティング構造を示す図、注意事項のテキスト、及びエラーコードと内容をまとめた表で構成されている。
</overview>

<contents>
### テキスト
#### サブルーチンプログラムの動作例
正しい演算例として、サブルーチンプログラムのFD0にD0を指定し、サブルーチンプログラム内でD4を使用した場合の動作を説明している。

#### 注意事項
- FBD/LDプログラムはサブルーチンプログラムとして作成できない。
- FBD/LDでは引数を持つサブルーチンプログラムの実行はできない。

### 図
#### ラダープログラム例
- M0がONのとき、CALL命令でP0のサブルーチンプログラムを呼び出し、D0を引数として渡す。
- サブルーチンプログラムP0内では、FD0をK100で割り、結果をK3回繰り返し、D4にK100を加算し、RET命令で戻る。

#### デバイス値の変化
- サブルーチンプログラム実行前のD0～D4の値とFD0の値を示す。
- CALL命令実行直後はD4は0のまま、FD0にD0～D3の値が格納される。
- サブルーチンプログラム実行時にD4が100に変わり、FD0の先頭3つの値が33、1、100に変化。
- RET命令実行後はD0が33、D1が1、D2が100、D3が1000、D4が100に変わり、FD0は元の不定値に戻る。

#### CALL命令のネスティング構造
- CALL命令は最大16重までネスティング可能。
- ネスティング16重はCALL(P)、FCALL(P)、ECALL(P)、EFCALL(P)、XCALL命令の合計。
- ネスティングの呼び出しと戻りの流れを矢印で示す。

### 表
#### エラーコード(SD0)
| エラーコード | 内容 |
| :--- | :--- |
| 2820H | (s1)～(s5)で引数に指定したデバイスがデータサイズ分確保できないとき。 |
| 3360H | 17重目のネスティングが実行されたとき。 |
| 3380H | (P)で指定したポインタのサブルーチンプログラムが存在しないとき。 |
| 3381H | CALL(P)命令実行後、RET命令を実行する前にEND命令、FEND命令、GOEND命令、STOP命令を実行したとき。 |
| 3382H | CALL(P)命令を実行する前にRET命令を実行したとき。 |
</contents>