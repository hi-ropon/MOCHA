ファイル名: MELSEC_iQ-R_プログラミングマニュアル（CPUユニット用命令_汎用FUN_汎用FB編）_page590

<overview>
本ページは、サブルーチンプログラムの動作例を中心に構成されています。ページ全体は以下のセクションで構成されています。
- テキスト部分：サブルーチンプログラムの動作説明、注意事項の記載
- 図部分：ラダープログラムの例（MAIN、ABC）、サブルーチンプログラム実行前後のデバイス値の変化を示す図、サブルーチンプログラムの呼び出し関係を示すフローチャート
- 表部分はなく、数値や状態の変化は図内のボックスで表現されている
</overview>

<contents>
### テキスト
#### サブルーチンプログラムの動作例
サブルーチンプログラムのFD0にD0を指定し、サブルーチンプログラム内でD4を使用した場合の動作を説明しています。

- ECALL命令で引数に指定されたデバイス番号は重複しないように注意が必要です。重複すると正常に演算できません。
- ECALL命令のネスティングは最大16重まで可能ですが、16重にはCALL、FCALL、ECALL、EFCALL、XCALL命令の合計が含まれます。
- サブルーチンプログラム内でONにしたデバイスは、サブルーチンプログラムが非実行でも保持されます。
- サブルーチンプログラム実行時にONにしたデバイスは、EFCALL命令でOFFにできます。

#### 注意事項
- FBD/LDプログラムはサブルーチンプログラムとして作成できません。
- FBD/LDでは引数を持つサブルーチンプログラムの実行はできません。

### 図
#### ラダープログラム例
- [MAIN]プログラムではM0がONのとき、ECALL命令で"ABC"サブルーチンプログラムを呼び出し、引数にP0、D0を指定しています。
- [ABC]サブルーチンプログラムでは、M0がONのとき、FD0をK100で割り、結果をFD0に格納し、D4にK100を加算しています。最後にRET命令で戻ります。

#### サブルーチンプログラム実行前後のデバイス値の変化
- 実行前はD0～D4にそれぞれ0、10、100、1000、0が格納されており、FD0は不定値(3)。
- ECALL命令実行直後はFD0にD0～D3の値が順に格納され、D4は0のまま。
- サブルーチンプログラム実行時はD4に100が入り、FD0は33、1、100、1000に変化。
- RET命令実行後はD0に33、D1に1、D2に100、D3に1000、D4に100が格納され、FD0は不定値(3)に戻る。

#### サブルーチンプログラム呼び出し関係図
- ECALL "ABC" P0が呼ばれるとP0が実行され、P0内でECALL "DEF" P10が呼ばれ、P10内でECALL "GHI" P20が呼ばれます。
- 各サブルーチンプログラムはFEND→ENDやRETで終了し、呼び出し元に戻ります。

</contents>