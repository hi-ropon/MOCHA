ファイル名: MELSEC_iQ-R_プログラミングマニュアル（CPUユニット用命令_汎用FUN_汎用FB編）_page1208

<overview>
本ページは主にテキストと表、及びタイミングを示す図で構成されています。  
テキスト部分ではSP.FTPGET命令の実行タイミングや動作条件、注意事項について詳細に説明しています。  
図はシーケンススキャンにおけるSP.FTPGET命令の実行タイミングを示すタイムチャート形式のもので、各信号の変化を視覚的に表現しています。  
表は不要ファイルの種類とそれに対する削除動作をまとめたものです。
</overview>

<contents>
### テキスト
#### SP.FTPGET命令の実行タイミング
- シーケンススキャンの各段階におけるSP.FTPGET命令の動作タイミングを示しています。
- FTPサーバ接続後のEND処理で完了デバイスがONになり、命令完了時に値を格納します。
- 全ファイル転送完了後にFTPクライアント接続状態がOFFになります。
- FTPサーバ接続中はSM1392がON、切断時にOFFとなります。
- SP.FTPGET命令実行中はSM753がONとなり、実行中は他のSP.FTPGET命令は実行不可。
- 転送先に空きサイズがない場合や一時ファイル作成設定が0の場合は異常完了します。
- CPUユニットの状態がRUN→STOPに変わってもファイル転送は完了まで継続。
- プロセスCPU（二重化モード）ではA系/B系それぞれのIPアドレスで通信。

#### 注意事項
- ファイル転送中にケーブル断やCPUユニットの電源断・リセットが発生した場合は再実行が必要。
- ケーブル断や電源断・リセット発生時に不要ファイルは以下のように削除される。

### 表
| 不要ファイル | 削除動作 |
| :--- | :--- |
| 一時ファイル(FTPCLI_I.TMP) | FTPクライアント内に残った一時ファイルは、次回の同一フォルダに対するファイル転送開始時に自動削除される。 |
| 不完全な転送対象ファイル | FTPクライアント内に残った不完全な転送対象ファイルは、次回の同一ファイルに対するファイル転送時に上書きされる。 |

#### その他の注意点
- 転送元ファイルに対し、転送先にファイルパスワード機能でアクセス制限されている同名ファイルがある場合、SP.FTPGET命令は異常完了。
- 一時ファイル作成設定を0にする場合、CPUユニットのフォルダパス長は最大243文字（末尾の区切り文字省略時は最大242文字）に制限。
- 転送先に12文字の一時ファイル(FTPCLI_I.TMP)が作成されるため、パス長の合計がCPUユニットの最大パス長（255文字）を超えないように注意。
- サポートされていない文字は「_」に変換されるため、ファイル転送時にファイル名やフォルダ名に未対応文字が含まれると正しく取得できない場合あり。
- プロセスCPU（二重化モード）ではファイル転送中の系切替直後にFTPサーバとのコネクションが切断されることがあり、その場合はFTPサーバが接続可能になるまでSP.FTPGET命令を再実行する必要あり。

### 図（シーケンススキャンにおけるSP.FTPGET命令の実行タイミング）
- 横軸はシーケンススキャンのステップ（0からENDまで）を示す。
- 縦軸は各信号やデバイスの状態を示す。
- 「SP.FTPGET命令」信号が命令実行中にONとなり、ファイル転送中はFTPクライアント接続状態(SM1392)がON。
- 完了ステータスや処理ファイル総数、処理完了ファイル数が命令完了時に更新される。
- 完了デバイス(d)はファイル転送完了時にONとなり、異常完了時もONになる。
- ファイル転送が正常完了すると1スキャン分の時間がかかることを示す。
- 注釈として、FTPサーバ接続後のEND処理でONになること、命令完了時に値を格納すること、全ファイル転送完了でOFFになることが記載されている。
</contents>