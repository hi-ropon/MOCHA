ファイル名: MELSEC_iQ-R_プログラミングマニュアル（CPUユニット用命令_汎用FUN_汎用FB編）_page1061

<overview>
本ページは「CPUユニット内蔵データベースアクセス機能」の一部で、主にDBTRANS(P)命令の動作説明に関する内容で構成されています。ページ全体は以下のセクションで構成されています。
・テキスト部分：DBTRANS(P)命令の機能説明、注意事項、エラー条件の説明
・図部分：DBTRANS(P)命令の動作タイミングを示すタイムチャート
・表部分：エラーコードとその内容の一覧表
グラフはなく、図は命令の動作フローを示すタイムチャートのみです。
</overview>

<contents>
### テキスト
#### 機能
- (s)で指定した識別番号に対するデータベースでのトランザクション開始を宣言する。
- (s)で指定したデータベース以外がオープンされている場合はトランザクション開始できず、DBTRANS命令は異常完了する。
- 正常完了すると、完了デバイス(d1)の完了信号がONになり、(d2)の完了ステータスに0が格納される。
- DBTRANS(P)命令実行時の完了デバイスの動作は図の通り。
- DBTRANS(P)命令でトランザクション開始後、DBCOMMIT(P)命令で確定、DBROLLBAK(P)命令で開始前の状態に戻す必要がある。
- DBTRANS(P)命令実行中はSM753（ファイルアクセス中）がONになるため、SM753がON中はDBTRANS(P)命令は実行不可。
- CPUユニットのユニットパラメータで「内蔵データベースアクセス使用有無」を“使用する”に設定している場合、SM1498がOFFの間はDBTRANS(P)命令は実行不可。

#### 注意事項
- 完了デバイス(d1)+1の異常完了信号がONになり、(d2)の完了ステータスにエラーコードが格納される場合がある。
- 以下の場合に異常完了となる：
  - データベースアクセス命令実行中にDBTRANS(P)命令を実行した場合
  - 範囲外の識別番号を指定した場合
  - すでにトランザクション開始状態でDBTRANS(P)命令を実行した場合
  - (s)で指定したデータベース以外がオープンされている場合
  - (s)でオープンしていない識別番号を指定した場合

### 図
- DBTRANS(P)命令の動作タイミングを示すタイムチャート
  - プログラムの進行に合わせてDBTRANS(P)命令が実行される。
  - 完了デバイス(d1)はOFFからONに変わり、トランザクション開始を示す。
  - 完了デバイス(d1)+1もOFFからONになるが、異常完了時にONになる。
  - END処理のタイミングで完了デバイスの状態が変化する。

### 表
#### エラーコード(SD0)
| エラーコード | 内容 |
| :--- | :--- |
| 2820H | (d1)で指定した範囲が、該当デバイス/ラベルを超える場合。 |

- オペランドの完了ステータスに格納されるエラーコードについては、1066ページの「データベースアクセス命令で発生するエラーコード」を参照するよう案内がある。
</contents>