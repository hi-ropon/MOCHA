ファイル名: MELSEC_iQ-R_プログラミングマニュアル（CPUユニット用命令_汎用FUN_汎用FB編）_page1182

<overview>
本ページは主に図（シーケンス図）で構成されており、テキストは図の説明や動作条件の補足に使われています。図はCPUユニットと外部機器間の通信プロトコルにおけるキャンセル要求時の動作を示すタイミングチャートで、2つのケース（受信待ち中と受信処理中）に分かれています。テキストは各ケースの動作説明と補足情報を含み、表やグラフはありません。
</overview>

<contents>
### テキスト
- 受信待ち中にキャンセル要求があった場合の動作説明
- 受信処理中にキャンセル要求があった場合の動作説明
- 各プロトコル実行状態（「3:受信データ待ち」「4:受信処理中」）における動作の違いを示す

### 図（シーケンス図）
#### 受信待ち中にキャンセル要求があった場合（プロトコル実行状態「3:受信データ待ち」）
- CPUユニット内のSP.ECPRTCL命令が動作開始
- 完了デバイス(d)および完了時の状態表示デバイス(d)+1は初期状態OFF
- コネクション番号(s1)に対して「1:キャンセル要求」が発生し、その後「2:キャンセル完了」となる
- CPUユニットは受信待ち時間または相手先生存確認タイマ時間中に中断される
- キャンセル完了後は次のプロトコルがあっても実行されない
- 完了デバイス(d)と状態表示デバイスはキャンセル完了時にONからOFFに切り替わる

#### 受信処理中にキャンセル要求があった場合（プロトコル実行状態「4:受信処理中」）
- CPUユニット内のSP.ECPRTCL命令が動作開始
- 完了デバイス(d)および完了時の状態表示デバイス(d)+1は初期状態OFF
- コネクション番号(s1)に対して「1:キャンセル要求」が発生し、その後「2:キャンセル完了」となる
- CPUユニットは受信処理中に中断される
- 受信データは外部機器からCPUユニットへ送信される
- 中断後、照合処理や一般データ処理などを中断し、専用命令を強制終了する
- キャンセル完了後は次のプロトコルがあっても実行されない
- 完了デバイス(d)と状態表示デバイスはキャンセル完了時にONからOFFに切り替わる

### 補足説明
- 「t」は受信待ち時間または相手先生存確認タイマ時間を示す
- 「中断」はキャンセル要求により処理が途中で停止されることを示す
- 完了デバイス(d)と完了時の状態表示デバイス(d)+1はキャンセル完了時の状態を示すために使用される
</contents>