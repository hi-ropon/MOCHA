ファイル名: MELSEC_iQ-R_プログラミングマニュアル（CPUユニット用命令_汎用FUN_汎用FB編）_page821

<overview>
このページは、Unicode文字列をシフトJIS文字列に変換し格納する機能の説明で構成されています。ページは主にテキスト説明、変換の具体例を示す図、そしてエラーコードの表の3つのセクションに分かれています。テキスト部分では機能の概要と注意点、図部分ではUnicodeからシフトJISへの変換動作の詳細なフローとバイトオーダーマークの有無による違いを示しています。表部分ではエラーコードとその内容が一覧で示されています。
</overview>

<contents>
### テキスト
#### 機能
- (s)で指定したUnicode文字列をシフトJIS文字列に変換し、(d)へ格納する。
- (s)のUnicode文字列はリトルエンディアンで指定する必要がある。
- (d)のシフトJIS文字列はビッグエンディアンで格納される。

#### 例
- Unicode文字列「6587H」は「6587H」で指定。
- シフトJIS文字列「95B6H」は「B695H」で指定。

### 図
#### バイトオーダーマーク無しの場合のUnicode→シフトJIS変換動作
- SM402、M0を使い、$MOVP_WS命令で文字列"ABC"をD0にセット。
- WS2SJISP命令でD0のUnicode文字列をD100にシフトJIS文字列として格納。
- (s)側のD0〜D6にUnicodeコード（例：6587H、5B57Hなど）がリトルエンディアンで並ぶ。
- (d)側のD100〜D104にシフトJISコード（例：B6H 95Hなど）がビッグエンディアンで並ぶ。

#### バイトオーダーマーク(FEFFH)付きの場合のUnicode→シフトJIS変換動作
- 同様に$MOVP_WS命令で文字列"123"をD0にセット。
- WS2SJISP命令でD0のUnicode文字列をD100に変換。
- (s)側のD0にバイトオーダーマークFFFEHが入り、その後にUnicodeコードが続く。
- (d)側のD100〜D104に対応するシフトJISコードがビッグエンディアンで格納される。
- バイトオーダーマークの有無で変換結果の格納方法が異なる。

### 表
#### エラーコード(SD0)
| エラーコード | 内容 |
| :--- | :--- |
| 2821H | (s)、(d)で指定した範囲が重複している場合。 |
| 3401H | (s)で指定した文字列にバイトオーダーマークのFEFFH(ビッグエンディアン)が付加されている場合。 |
| 3405H | (s)で指定した文字列が変換できない文字コードを含む場合。 |
| 3405H | (s)で指定した文字列が16383文字を超える場合。 |

*注記* 漢字などシフトJISコードで2バイトデータになる文字は1文字あたり2とカウントする。
</contents>