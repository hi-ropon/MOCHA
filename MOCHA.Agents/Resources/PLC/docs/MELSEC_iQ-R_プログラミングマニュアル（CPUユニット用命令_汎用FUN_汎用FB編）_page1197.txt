ファイル名: MELSEC_iQ-R_プログラミングマニュアル（CPUユニット用命令_汎用FUN_汎用FB編）_page1197

<overview>
本ページは、ファイル転送機能用命令に関する説明で構成されています。主にテキスト部分でFTPサーバのフォルダパス区切り文字の仕様、ファイル転送時の注意点、完了デバイスの動作説明、命令の実行タイミングについて詳細に記載されています。図はSP.FTPPUT命令の実行タイミングを示すシーケンススキャンのタイムチャートで、各信号のON/OFF状態やファイル転送の流れを視覚的に表現しています。表はなく、文章と図で構成された技術的な解説ページです。
</overview>

<contents>
### テキスト
#### フォルダパス区切り文字について
- フォルダパスの区切り文字は半角の「¥」または「/」を使用する。
- 末尾の区切り文字は省略可能。
- FTPサーバによっては「¥」を区切り文字として使用できない場合がある。
- s3にNULLまたはデバイスに「0000H」のみ指定した場合はFTPサーバのホームディレクトリ直下にアクセスする。
- 同名ファイルが存在する場合は上書きされる。
- 送付可能ファイルサイズは1ファイル最大4GB。

#### 完了デバイス(d)の動作
- SP.FTPPUT命令実行および正常/異常完了は設定データで指定した完了デバイス(d)、完了時の状態表示デバイス(d)+1で確認可能。
- 完了デバイス(d)は命令完了時にONし、次のEND処理でOFFになる。
- 状態表示デバイス(d)+1は命令完了時の状態によりON/OFFする。正常完了時はOFFのまま変化しない。
- 異常完了時は完了デバイス(d)がONし、状態表示デバイス(d)+1もONになる。異常完了時にはエラーコードを格納。

#### SP.FTPPUT命令の実行タイミング
- 命令実行時にFTPサーバ接続後のEND処理で完了デバイスをONにする。
- 命令完了時に値を格納し、全ファイル転送完了後にOFFにする。
- FTPサーバ接続中はSM1392（FTPクライアント接続状態）がON、切断時にOFF。
- 命令実行中はSM753（ファイルアクセス中）がON。SM753がON中はSP.FTPPUT命令は実行不可で無処理となる。
- SP.FTPPUT命令またはSP.FTPGET命令を実行中に同命令を実行すると、先行命令が完了するまで後続命令は無視される。無視された場合はSM699（専用命令未実行フラグ）がON。
- 転送先に空きサイズがない場合や一時ファイル作成設定が0の場合、異常完了となる。
- ファイル転送中にCPUユニットの状態がRUN→STOPに変わっても転送は継続。
- プロセスCPU（二重化モード）ではA系/B系それぞれのIPアドレスで通信。

### 図
#### SP.FTPPUT命令の実行タイミング（シーケンススキャンタイムチャート）
- 横軸はシーケンススキャンのカウント（0～END）。
- 縦軸にSP.FTPPUT命令、完了ステータス(s1)+1、処理ファイル総数(s1)+2、処理完了ファイル数(s1)+3、完了デバイス(d)、完了時の状態表示デバイス(d)+1、FTPクライアント接続状態(SM1392)を示す。
- 命令実行時にFTPサーバ接続後のEND処理で完了デバイス(d)がONになる。
- ファイル転送中はFTPクライアント接続状態がON。
- 正常完了時は完了デバイス(d)がONのまま1スキャン維持後OFFに、状態表示デバイス(d)+1はOFFのまま。
- 異常完了時は完了デバイス(d)と状態表示デバイス(d)+1がONになる。
- ファイル転送完了後に完了デバイス(d)がOFFになる。

</contents>