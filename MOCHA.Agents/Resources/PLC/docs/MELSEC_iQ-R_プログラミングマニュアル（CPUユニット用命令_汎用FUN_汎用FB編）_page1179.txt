ファイル名: MELSEC_iQ-R_プログラミングマニュアル（CPUユニット用命令_汎用FUN_汎用FB編）_page1179

<overview>
このページは「内蔵Ethernet機能用命令」の一部である「通信プロトコル支援機能命令」について説明しています。構成は以下の通りです。
- テキスト部分：SP.ECPRTCL命令の機能説明、実行タイミング、プロトコルキャンセル要求の概要
- 図部分：SP.ECPRTCL命令の実行タイミングを示すシーケンス図、プロトコルキャンセル要求の動作フロー図
- 表部分はなし
</overview>

<contents>
### テキスト
#### 機能
- エンジニアリングツールで登録したプロトコルを実行する。
- (s1)で指定されたコネクションを使用し、(s3)で指定されたデバイス以降のコントロールデータに従う。
- 1回の命令実行で、(s2)で指定した最大8個のプロトコルを連続実行する。
- 実行結果は実行結果(s3)+0に格納される。
- 実行状態は通信プロトコル支援機能実行状態確認用エリア(Un¥G350～Un¥G669)で確認可能。
- 正常/異常完了は設定データで指定した完了デバイス(d)、完了時の状態表示デバイス(d)+1で確認できる。
- 完了デバイス(d)はスキャンのEND処理でONし、次のEND処理でOFFになる。
- 正常完了時はOFFのまま変化しない。異常完了時はエラーコードを格納。

#### SP.ECPRTCL命令の実行タイミング
- シーケンススキャンの各END間で命令が実行される。
- 完了デバイス(d)と完了時の状態表示デバイス(d)+1のON/OFF状態で正常完了や異常完了を判別。
- 1回の命令で設定データの数だけ（最大8個）プロトコルを連続実行。

#### プロトコルキャンセル要求
- プロトコルの実行をキャンセル可能。
- キャンセル指定は通信プロトコル支援機能実行状態確認用エリア(Un¥G350～Un¥G669)を使用。
- ユーザからのキャンセル要求を受け、CPUユニットが指定コネクション番号(s1)の実行中プロトコルをキャンセルする。

### 図
#### SP.ECPRTCL命令の実行タイミング（シーケンス図）
- 横軸にシーケンススキャンの4つのEND区間を示す。
- SP.ECPRTCL命令は最初のEND区間で命令実行される。
- 完了デバイス(d)は命令実行後ONになり、次のEND区間でOFFになる。
- 完了時の状態表示デバイス(d)+1は正常完了時にON、異常完了時にもONになるが、正常完了は1スキャンの間だけON。
- プロトコルは設定データの数だけ連続実行される（最大8個）。

#### プロトコルキャンセル要求の動作フロー図
- ユーザがコネクション番号(s1)でキャンセル要求を出す。
- CPUユニットはそのコネクション番号で実行中のプロトコルをキャンセル。
- キャンセル完了の応答がユーザに返される。

</contents>