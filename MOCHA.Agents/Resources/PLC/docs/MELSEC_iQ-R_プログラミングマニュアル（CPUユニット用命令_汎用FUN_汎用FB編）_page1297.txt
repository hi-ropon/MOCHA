ファイル名: MELSEC_iQ-R_プログラミングマニュアル（CPUユニット用命令_汎用FUN_汎用FB編）_page1297

<overview>
本ページは、二重化システム用命令の「系切替え」に関する説明で構成されています。ページ全体は主にテキスト説明と2種類のタイミングにおける系切替えの動作を示す図（タイムチャート）で構成されています。テキスト部分では系切替え命令の動作条件や注意事項が記載されており、図部分ではSP.CONTSW命令実行時の異常完了デバイスのON/OFF状態とプログラムの実行・停止状態の変化が示されています。表やグラフはなく、図は動作の流れを示すフローチャート的なタイムチャートです。
</overview>

<contents>
### テキスト
- (d)で指定した異常完了デバイスは、系切替え命令の実行により系が切り替わったときにOFFとなり、系切替えが実行できなかったときにONとなる。
- 系切替え不可要因により系切替えが実行できなかった場合、制御系のSD1643（系切替え要因）に16（系切替え命令による系切替え要求）が格納され、SD1644（系切替え不可要因）に系切替え不可要因No.が格納される。
- SD1644に格納される系切替え不可要因No.については別資料「MELSEC iQ-R CPUユニットユーザーズマニュアル（応用編）」を参照。
- SP.CONTSW命令により系が切り替わったときの動作を示すタイムチャートが2種類掲載されている。

#### タイムチャート（A系、B系の動作）
1. **SP.CONTSW命令実行時に異常完了デバイスがONの場合**
   - プログラム実行中にSP.CONTSW命令が実行されると、異常完了デバイスがOFFになる。
   - 系切替えが行われ、制御系と待機系が入れ替わる。
   - プログラムは停止から実行へ切り替わる。

2. **SP.CONTSW命令実行時に異常完了デバイスがOFFの場合**
   - プログラム実行中にSP.CONTSW命令が実行されると、異常完了デバイスはONにならずOFFのまま維持される。
   - 制御系は継続して動作し、待機系は待機状態のまま。
   - プログラムは停止状態のまま。

### 注意事項
- SP.CONTSW命令を実行する際は、SM1646（ユーザ系切替え許可）をON（許可）に設定する必要がある。OFF（禁止）に設定されている場合、SP.CONTSW命令による系切替えは実行されない。
- SM1646がON（許可）の状態でSP.CONTSW命令を実行後、実際に系切替え処理を行うEND処理までの間にSM1646をOFFにしても、系切替え処理は実行される。

### 図（タイムチャート）
- **SP.CONTSW命令実行時に異常完了デバイスがONのケース**
  - プログラム実行中に命令が実行される。
  - 異常完了デバイスがONからOFFに切り替わる。
  - 制御系から待機系へ系切替えが行われる。
  - 待機系が制御系に切り替わり、プログラムが停止から実行に変わる。

- **SP.CONTSW命令実行時に異常完了デバイスがOFFのケース**
  - プログラム実行中に命令が実行される。
  - 異常完了デバイスはOFFのまま変わらない。
  - 制御系は継続して動作し、待機系は待機状態のまま。
  - プログラムは停止状態のまま維持される。

以上の内容により、系切替え命令の動作条件と実行結果、及び注意点が理解できる。
</contents>