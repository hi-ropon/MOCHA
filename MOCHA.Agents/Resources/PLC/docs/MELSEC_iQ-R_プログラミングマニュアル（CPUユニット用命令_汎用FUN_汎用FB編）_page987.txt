ファイル名: MELSEC_iQ-R_プログラミングマニュアル（CPUユニット用命令_汎用FUN_汎用FB編）_page987

<overview>
このページは「インデックスレジスタ命令」に関する説明で構成されています。主にテキスト部分で機能の概要や動作説明が記載されており、表形式で(s)の値と退避するZ、LZの範囲が示されています。また、図部分では退避回数やシステム使用領域、ZおよびLZの各領域の構成を示したメモリマップのような構造図が掲載されています。全体として、インデックスレジスタやロングインデックスレジスタの退避動作とその管理方法について解説しています。
</overview>

<contents>
### テキスト
#### 機能
- (s)で指定した退避するインデックスレジスタ、ロングインデックスレジスタを、(d)で指定したデバイスまたは配列型ラベルの要素以降に退避します。
- 退避したデータの末尾に、退避したインデックスレジスタ、ロングインデックスレジスタの種別を格納します。
- インデックスレジスタ、ロングインデックスレジスタの内容を退避すると退避回数(d)が+1されます。
- (s)で指定する値と退避するインデックスレジスタ、ロングインデックスレジスタの範囲は以下の通り。

| (s)の値 | 退避するZ、LZ |
|---------|---------------|
| 1       | Z、LZ全範囲   |
| 2       | Z全範囲       |
| 3       | LZ全範囲      |

- データの復帰には、インデックスレジスタ/ロングインデックスレジスタ選択復帰命令(ZPOP(P)命令)を使用します。
- インデックスレジスタ/ロングインデックスレジスタ選択退避命令(ZPUSH(P)命令)とZPOP(P)命令は対で使用し、入れ子構造にすることでスタックとして使用可能です。
- 入れ子構造は、ZPUSH(P)命令の(d)で指定した領域を再度ZPUSH(P)命令の(d)に指定することで作成可能で、実行するごとに退避回数(d)が+1されます。
- 入れ子構造と別の領域を指定した場合は、指定した別の領域に内容を退避します。
- 入れ子構造の場合、退避したデータが追加されていくため、SD300、SD301でインデックスレジスタ、ロングインデックスレジスタ点数を確認し、使用回数分の領域を確保する必要があります。
- (d)以降に使用される領域の構成は図の通り（Z0～23、LZ0～4の場合）。

### 図
- 図は退避回数(d)を基点にしたメモリ領域の構成を示しています。
- (d)+1から(d)+38までの領域に、システム使用領域（2ワード）、Z0～Z13、LZ0～LZ4の各領域がネスティング（入れ子）単位で配置されています。
- 1ネスティング目は25ワード分、2ネスティング目は11ワード分の領域が割り当てられています。
- 各ネスティングの最後にZ、LZ退避種別の識別値が格納されています。
- ZPUSH命令のパラメータ例として、(Z、LZ全範囲退避)や(LZ全範囲退避)が示されています。

以上より、このページはインデックスレジスタおよびロングインデックスレジスタの退避・復帰の仕組みと、そのメモリ配置構造を詳細に解説しています。
</contents>