ファイル名: MELSEC_iQ-R_プログラミングマニュアル（CPUユニット用命令_汎用FUN_汎用FB編）_page656

<overview>
本ページは「バイナリ書き込み時」の動作説明に関するテキストと、それに対応したデータ構造の説明図で構成されています。テキスト部分では、ファイルの拡張子や新規作成・追加保存時の動作、エラー発生時の挙動などの注意点が記載されています。図部分は、BIN16ビットデータの書き込み要求時のコントロールデータとファイルデータの配置・書き込み方法を示すフローチャート的な構造図となっています。表形式のデータはなく、説明はテキストと図で完結しています。
</overview>

<contents>
### テキスト
#### バイナリ書き込み時の動作概要
- 対象ファイルの拡張子を省略した場合、拡張子は「.BIN」となる。
- 存在しないファイルが指定された場合は、新規にファイルを作成し、先頭からデータを書き込む。この新規ファイルはアーカイブ属性で設定される。
- 既存ファイルが指定された場合は、そのファイルの先頭から書き込みを行う。書き込み中に既存ファイルのサイズを超えた場合は、超えた部分は追加保存される。
- 指定されたファイル位置が既存ファイルのサイズより大きい場合は、0点での書き込みとなり正常終了する。
- 書き込み中に空きエリアがなくなった場合はエラーとなるが、書込みおよび追加保存に成功した部分まではそのまま書き込まれた状態となり、追加保存可能な分だけ保存した後にエラー終了する。
- BIN16ビットデータのバイナリ書き込み時の要求書き込みデータ数やファイル位置指定時の書き込み方法は以下の図で示される。

### 図の説明
#### コントロールデータ構造
- (d1)+0: 実行/完了タイプ（例：0000H）
- (d1)+1: 完了ステータス（未使用の場合は「-」）
- (d1)+2: 書き込み結果データ数（例：K3）
- (d1)+3: 未使用（「-」）
- (d1)+4: ファイル位置（例：K1）
- (d1)+5: 列数指定
- (d1)+6: データタイプ指定（例：K0）
- (d1)+7: データタイプ指定（例：K0）

#### データ格納デバイスとファイルデータの対応
- データ格納デバイス(s3)+0に書き込み結果データ数K3が入る。
- 書き込みデータは(s3)+1から(s3)+3までの3つのワードで構成され、それぞれが2バイトのファイルデータに対応。
- ファイルデータはバイト単位で並び、1ワード（2バイト）ずつシフトしながら書き込まれる。
- 具体例として、(s3)+1の33H 22Hはファイルデータの22H、33Hに対応し、(s3)+2の55H 44Hは44H、55Hに対応する。

#### 書き込みの流れ
- コントロールデータの指示に従い、ファイル位置や列数、データタイプを指定。
- 書き込みデータはデータ格納デバイスからファイルデータへ1ワードずつシフトしながら書き込まれる。
- 書き込み結果データ数に基づき、指定されたデータ数分の書き込みを行う。

以上により、バイナリ書き込み時のファイル操作の詳細な動作とデータ配置方法が理解できる。
</contents>